/* module-tac@v1.0.0 build with â™¥ by bb-lp-cli@v1.9.17 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("base"),require("core"),require("ui"),require("module-amb-analytics"),require("module-numpad"),require("module-amb-loading"),require("lodash")):"function"==typeof define&&define.amd?define(["base","core","ui","module-amb-analytics","module-numpad","module-amb-loading","lodash"],t):"object"==typeof exports?exports["module-tac"]=t(require("base"),require("core"),require("ui"),require("module-amb-analytics"),require("module-numpad"),require("module-amb-loading"),require("lodash")):e["module-tac"]=t(e.base,e.core,e.ui,e["module-amb-analytics"],e["module-numpad"],e["module-amb-loading"],e.lodash)}(this,function(e,t,a,r,o,n,i){return function(e){function t(r){if(a[r])return a[r].exports;var o=a[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var a={};return t.m=e,t.c=a,t.p="/",t(0)}([function(e,exports,t){e.exports=t(1)},function(e,exports,t){var a;(function(e){"use strict";a=function(require,exports,e){e.name="module-tac";var a=t(3),r=t(4),o=t(5),n=t(6),i=t(7),l=t(8),c=[r.name,o.name,n.name,i.name,l.name];e.exports=a.createModule(e.name,c).directive(t(9)).service(t(11))}.call(exports,t,exports,e),!(void 0!==a&&(e.exports=a))}).call(exports,t(2)(e))},function(e,exports){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(t,exports){t.exports=e},function(e,exports){e.exports=t},function(e,exports){e.exports=a},function(e,exports){e.exports=r},function(e,exports){e.exports=o},function(e,exports){e.exports=n},function(e,exports,t){var a;a=function(require,exports){"use strict";var e=(t(10),t(3).utils,document.URL.indexOf("http://")===-1&&document.URL.indexOf("https://")===-1);exports.amDirectiveTac=function(t,a,r,o,n,i,l){return o.put("$DefaultTemplate.html",'<div class="form-inline"><div class="form-group form-group--tac-parent">    <div class="clearfix tac-parent form-inline u-vtop"> <div class="label-parent"><label class="control-label control-label--longtext control-label--noleft" lp-i18n="module-tac.tac.js.tac_required" for="tacNo"></label></div>       <div class="u-inlineblock btn--requesttac" ng-hide="tacDisplay">                <button class="amb-primary-btn--yellow btn btn-important"                    name="{{\'module-tac.tac.js.request_tac_no\' | translate}}"                    amb-analytic="request for TAC number"                   ng-click="requestTac()" ng-disabled="disableFlag"                    lp-i18n="module-tac.tac.js.request_tac">                </button> <div class="error"><div class="err-bubble" ng-show="error.tacBool"><span class="err-up"></span>{{error.tac}}</div></div><div class="checkthis"><input ng-blur="fieldChange(tacNo, \'tac\' )"/></div>       </div> <p class="tac-desc" ng-hide="tacDisplay">{{\'module-tac.tac.js.send_tac\' | translate}}</p>       <div class="form-group form-group--tac" ng-show="tacDisplay">                <input type="password" pattern="[0-9]*"  disable-scroll parse-string-to-model str-model="tacNo.value"                    name="{{\'module-tac.tac.js.tacno\' | translate}}"                    class="form-control"                    autocomplete="off"                    ng-model="tacNo.numValue" placeholder="{{\'module-tac.tac.js.enter_tac\' | translate}}" name="requestTac"                    ng-change="validating && fieldChange(tacNo, \'tac\' )"                    ng-blur="fieldBlur(tacNo, \'tac\' )"                    ng-class="{\'err-border\':error.tacBool}" maxlength="6"                    oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"                    ng-required="true" id="tacNo"                /> <div class="error"><div class="err-bubble" ng-show="error.tacBool"><span class="err-up"></span>{{error.tac}}</div></div>       </div> <div class="u-inlineblock" ng-show="tacDisplay"><p class="tac-desc">{{\'module-tac.tac.js.tac_sent\' | translate}}<span class="u-inlineblock">({{newPhoneNum}})</span> <br/><span class="u-inlineblock" ng-if="disableBtn">{{\'module-tac.tac.js.receive_tac_2min\' | translate}}</span><span class="u-inlineblock" ng-if="!disableBtn">{{\'module-tac.tac.js.didnt_receive_tac\' | translate}}<a href="javascript:;" ng-click="requestTac(disableBtn)" class="textlink">{{\'module-tac.tac.js.request_new_tac\' | translate}}</a></span></p></div>   </div> </div></div></div>'),o.put("$SoftTokenTemplate.html",'<div class="form-inline">    <div class="form-group form-group--tac-parent">        <div class="clearfix tac-parent form-inline u-vtop" ng-show="preAuthenticate && !preAuthenticateError">            <div class="label-parent">                <label class="control-label control-label--longtext control-label--noleft" lp-i18n="module-tac.tac.js.authorization_required"></label>            </div>            <div class="u-inlineblock btn--requesttac">                <button class="amb-primary-btn--yellow btn btn-important amb-push-btn--yellow"                    name="{{\'module-tac.tac.js.request_authorization1\' | translate}}"                    amb-analytic="request for TAC number"                    ng-click="authorizeWithYesSafe()"                    ng-disabled="disableFlag"                    lp-i18n="module-tac.tac.js.request_authorization">                </button>                <div class="error">                    <div class="err-bubble" ng-show="error.softTokenBool">                        <span class="err-up"></span>                        {{error.softToken}}                    </div>                </div>            </div>            <p class="tac-desc">{{\'module-tac.tac.js.send_authorization\' | translate}}</p>            <div class="checkthis"><input ng-blur="checkClicked()"/></div>        </div>        <div class="clearfix tac-parent form-inline u-vtop" ng-show="!preAuthenticate">            <label class="control-label control-label--longtext control-label--noleft amb-push-tac-parent-content" lp-i18n="module-tac.tac.js.authorization_success"></label>            <label class="control-label control-label--longtext control-label--noleft amb-push-tac-child-content" lp-i18n="module-tac.tac.js.confirm"></label>        </div>        <div class="clearfix tac-parent form-inline u-vtop" ng-show="preAuthenticateError">            <label class="control-label control-label--longtext control-label--noleft amb-push-tac-parent-content" style="color:#f61c32" lp-i18n="module-tac.tac.js.authorization_not_success"></label>                <div class="error">                    <div class="err-bubble" ng-show="error.softTokenErrorBool">                        <span class="err-up"></span>                        {{error.softTokenError}}                    </div>                </div>            <div class="checkthis"><input ng-blur="checkClickedError()"/></div>        </div>    </div> </div><div class="overlay-bg" ng-if="authorizing"></div><div class="popup-action-parent popup-parent amsecure-loading" ng-if="authorizing">    <div class="popup-article-content text-left">        <h3 class="popup-article-title" style="font-weight: normal;">{{\'module-tac.tac.js.authorization_sent\' | translate}}</h3>        <div class="text-center">            <div class="amsecure-loading-mobile" ng-if="isMobile"><div></div></div>            <img ng-if="!isMobile" src="{{mediaPath}}/loading.svg"></img>        </div>    </div></div>'),{restrict:"E",scope:{onErr:"=",notifyErr:"=",error:"=",authContext:"=",authConfig:"=",validating:"=",transactionId:"="},template:'<div ng-include="templateUrl"></div>  ',link:function(o,i,c){function s(e){var t={sms:"$DefaultTemplate.html",st:"$SoftTokenTemplate.html",default:"$DefaultTemplate.html"};return t[e]?t[e]:t.default}function u(e,t){var a=e.split("=");return a[t]}function d(){if(void 0!==o.authContext&&void 0!==o.authContext["x-auth-ctx"]&&""!==o.authContext["x-auth-ctx"]){var e="";e=o.authContext["x-auth-ctx"];var t=[];t=e.split(";"),o.tacType=u(t[0],0),o.templateUrl=s(o.tacType)}else o.templateUrl=""}function p(e){o.authConfig.headers["x-Tac"]=o.tacType+"="+e}function f(e){var t=/^[0-9]+$/i;return e.value?e.value.toString().length>6?l.instant("module-tac.tac.js.too_long"):e.value.toString().match(t)?e.value.toString().length<6?"":null:l.instant("module-tac.tac.js.invalid_tac"):l.instant("module-tac.tac.js.enter_tac1")}function h(e,t){var a=[],r="",n="",i={},l=!1;if(i=void 0!==t.data?t.data:t,console.log(t),console.log(i),t.status>=400&&t.status<500)if(401===t.status||403===t.status)i.error||i.error_description?(n=i.error+" - "+i.error_description,o.notifyErr("",n)):(n="",l=!0),n+=" "+v(t.headers()),o.notifyErr(e,n);else if(void 0!==i.errors&&null!==i.errors){if(a=i.errors,m&&1===a.length&&void 0===a[0].field)return n=a[0].code+" - "+a[0].message,n+="  "+v(t.headers()),void o.notifyErr("",n);for(var c=0;c<a.length;c++)r=a[c].field,n=a[c].code+" - "+a[c].message,o.onErr(r,n)}else i.code||i.message?n=i.code+" - "+i.message:(n="",l=!0),n+="  "+v(t.headers()),l?o.notifyErr(e,n):o.notifyErr("",n);else if(t.status>=500){if(i.code||i.message?n=i.code+" - "+i.message:void 0!==i.errors&&null!==i.errors?(a=i.errors,a&&(n=a[0].code+" - "+a[0].message)):(n="",l=!0),m&&i.errors)for(var c=0;c<i.errors.length;c++)n+=" | "+i.errors[c].code+" - "+i.errors[c].message;n+="  "+v(t.headers()),l?o.notifyErr(e,n):o.notifyErr("",n)}}o.tacDisplay=!1,o.preAuthenticate=!0,o.preAuthenticateError=!1,o.tacNo={value:"",numValue:""},o.disableFlag=!0;var m=n.getPagePreference("requestIdFlag");o.mediaPath=a.getResolvedPreference("mediaPath"),o.authorizing=!1,o.isMobile=n.isMobileDevice()&&e,o.$watch("tacDisplay",function(e,t){o.tacDisplay===!0?o.onErr("tac",null):o.error&&o.error.tac&&delete o.error.tac}),o.$watch("authContext",function(e,t){e!==t&&d()}),o.$watch("error",function(e,t){if(void 0===o.error)o.disableFlag=!1;else{var a=0;for(var r in o.error)++a;a<=3&&(void 0!==o.error.tac||void 0!==o.error.softToken||void 0!==o.error.softTokenError)?o.disableFlag=!1:o.disableFlag=!0}},!0),o.$watch("tacNo.value",function(e,t){void 0!==o.tacNo.value&&""!==o.tacNo.value?p(e):o.tacDisplay===!0&&o.onErr("tac","")},!0),o.startTimer=function(){var e=a.getResolvedPreference("resendTACInterval");e=12e4,t(function(){o.disableBtn=!1},e)},o.fieldChange=function(e,t){var a=f(e);""===e&&(a=""),o.onErr(t,a)},o.fieldBlur=function(e,t){var a=f(e);!a&&e.value&&e.value.toString().length<6&&(a=l.instant("module-tac.tac.js.too_short")),e.skip&&(a=null),o.onErr(t,a)},o.requestTac=function(e){if(!e){o.$emit("authorizing",{}),o.onErr("tac",null);var t={transactionId:o.transactionId};r.tacRequest(t).then(function(e){o.phoneNum=e.data.phoneNum,console.log("scope.phoneNum ",o.phoneNum);var t=String(o.phoneNum);console.log("newVal",t);for(var a=t.slice(-4),r="",n=t.length-4;n>0;n--)r+="*";var i=r.slice(0,4),l=r.slice(4,r.length),c=i+" "+l+" "+a;o.newPhoneNum=c,o.tacDisplay=!0,o.disableBtn=!0,o.startTimer()}).catch(function(e){h("Authentication",e)})}},o.authorizeWithYesSafe=function(){o.authorizing=!0,o.$emit("authorizing",{});var e=a.getResolvedPreference("softTokenAuthSrc"),t={trxId:o.transactionId},n={headers:{"x-auth-ctx":o.authContext["x-auth-ctx"],"x-auth-rule":o.authContext["x-auth-rule"]}};r.authSoftTokenRequest(e,t,n).then(function(e){o.preAuthenticate=!1,o.preAuthenticateError=!1,o.authorizing=!1}).catch(function(e){o.preAuthenticateError=!0,h("Authentication",e),o.authorizing=!1})},o.checkClicked=function(){o.preAuthenticate&&o.onErr("softToken",l.instant("module-tac.tac.js.authorize_transaction"))},o.checkClickedError=function(){o.preAuthenticateError&&o.onErr("softTokenError",l.instant("module-tac.tac.js.error_authorize_transaction"))};var v=function(e){var t="";return m===!0&&void 0!==e["x-request-id"]&&""!==e["x-request-id"]&&(t="x-request-id-"+e["x-request-id"]),t};d()}}},exports.amDirectiveTac.$inject=["$timeout","lpWidget","tacRequestService","$templateCache","lpCoreUtils","spinner","lpCoreI18n"]}.call(exports,t,exports,e),!(void 0!==a&&(e.exports=a))},function(e,exports){e.exports=i},function(e,exports,t){var a;a=function(require,exports,e){"use strict";exports.tacRequestService=function(e){var t;return{setConfig:function(e){t=e},tacRequest:function(a){return console.log("tacEndPoint",t),console.log("reqObj",a),e.post(t,a).then(function(e){return e}).catch(function(e){throw e})},authSoftTokenRequest:function(t,a,r){return e.post(t,a,r).then(function(e){return e}).catch(function(e){throw e})}}},exports.tacRequestService.$inject=["$http"]}.call(exports,t,exports,e),!(void 0!==a&&(e.exports=a))}])});
//# sourceMappingURL=main.js.map