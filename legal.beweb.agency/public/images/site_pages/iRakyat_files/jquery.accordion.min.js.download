(function(a){a.fn.simpleAccordion=function(b){var c=a(this);b=(b)?b:{};if(!b.node&&c.length){b.node=c}b.node=a(b.node);b.node.each(function(){var d=new a.jk.simpleAccordion(b)});return c};if(!a.jk){a.jk={}}a.jk.simpleAccordion=function(c){var b=this,d;c=(c)?c:{};a.extend(b,((c)?c:{}));b.node=a(((c.node)?c.node:null));if(b.node&&b.node.length===1){d=b.node}else{b.node=null;return b}if(a.isArray(b.data)){this.buildFaqsFromData()}d.addClass(b.ns+"_list");b.faqNodes=d.children(b.nodeType).addClass(b.ns+"_item");b.setupBasicActions();b.showDefaultItem();if(b.allowSearch){b.searchNode=a(b.searchNode);if(b.searchNode.length){if(b.score===null&&(typeof a.score=="function")){b.score=a.score}if(typeof b.score=="function"){b.addSearchUI();if(!b.showAllOnEmpty){b.hideSearchResults(b.faqNodes)}}else{b.allowSearch=false;b.searchNode=null;b.score=null}}else{b.allowSearch=false;b.searchNode=null}}d.data(b.ns,b).trigger("init."+b.ns,[b])};a.extend(a.jk.simpleAccordion.prototype,{data:null,nodeType:"li",questionClass:"accordion",answerClass:"content",tagClass:"tags",showOnlyOne:false,changeHash:true,slideSpeed:500,allowSearch:false,score:null,searchNode:null,minSearchScore:0.5,sortSearch:false,showAllOnEmpty:true,caseSensitive:false,keyTimeout:400,partialTagScore:0.1,exactTagScore:0.2,node:null,ns:"simpleAccordion"});a.extend(a.jk.simpleAccordion.prototype,{setupBasicActions:function(){var b=this;b.node.on("mouseover","."+b.questionClass,function(){a(this).addClass(b.ns+"Hover")}).on("mouseout","."+b.questionClass,function(){a(this).removeClass(b.ns+"Hover")}).on("click."+b.ns,"."+b.questionClass,function(d){var c=a(this).parents("."+b.ns+"_item");if(b.showOnlyOne){b.hideAll(c)}b.toggleFaq(c)})},buildFaqsFromData:function(){var d=this,e="";for(var c=0,b=d.data.length;c<b;++c){e+="<"+d.nodeType+"><p class='"+d.questionClass+"'>"+d.data[c].question+"</p><div class='"+d.answerClass+"'>"+d.data[c].answer+"</div><p class='"+d.tagClass+"'>"+(d.data[c].tags||"")+"</p></"+d.nodeType+">"}d.node.append(e)},toggleFaq:function(d,b){var e=this;d=(d||a(e.faqNodes.get(0)));var c=d.find("."+e.answerClass);b=(b||function(){});c.slideToggle(e.slideSpeed,function(){if(c.is(":visible")){d.addClass(e.ns+"Showing");e.node.trigger("show."+e.ns,[d[0]]);if(e.changeHash){var f=d.attr("id");if(f&&f.length>0){document.location.hash=escape(f)}}}else{d.removeClass(e.ns+"Showing");e.node.trigger("hide."+e.ns,[d[0]])}b()})},hideAll:function(e,b){var d=this,c=0,f=null;e=(e||null);b=(b||function(){});f=d.faqNodes.find("."+d.answerClass+":visible");if(e){f=f.not(e.find("."+d.answerClass))}if(f.length){f.slideUp(d.slideSpeed,function(){var g=a(this).parents("."+d.ns+"_item").removeClass(d.ns+"Showing");d.node.trigger("hide."+d.ns,[g[0]]);c++;if(c>=f.length){b()}})}else{b()}},showDefaultItem:function(){var b=this,d=document.location.hash,c=null;if(d&&d.length>0){c=a(d);if(c.length&&c.is("."+b.ns+"_item")){b.toggleFaq(c)}}},hideSearchResults:function(b){var c=this;b.hide().removeClass(c.ns+"Result "+c.ns+"Showing").find("."+c.answerClass).hide()},addSearchUI:function(){var b=this;if(!b.searchNode||!b.searchNode.length){return}b.__sto=null;b.searchNode.addClass(b.ns+"Search").keyup(function(c){clearTimeout(b.__sto);b.__sto=null;b.__sto=setTimeout(function(){b.handleSearchKey(b.searchNode.val())},b.keyTimeout)})},handleSearchKey:function(c){var e=this,g=[];e.node.trigger("searchStart."+e.ns);if(c.length<1){e.hideSearchResults(e.faqNodes);if(e.showAllOnEmpty){e.faqNodes.show()}e.node.trigger("searchEnd."+e.ns,[g]);return g}g=e.doScoring(c);if(e.sortSearch){g.sort(function(i,h){return h[0]-i[0]});e.node.trigger("sort."+e.ns,[g])}var f=[];for(var d=0,b=g.length;d<b;++d){g[d][1].show().addClass(e.ns+"Result");f.push(g[d][1][0]);if(e.sortSearch){e.node.append(g[d][1])}}e.hideSearchResults(e.faqNodes.not(f));e.node.trigger("searchEnd."+e.ns,[g]);return g},doScoring:function(c){var e=this,d=[],b=[];if(!c||!c.length){return d}c=""+((e.caseSensitive)?c:c.toLowerCase());b=(""+c).split(" ");e.faqNodes.each(function(){var g=a(this),k="",j=0;k=g.find("."+e.questionClass).text();k+=" "+g.find("."+e.answerClass).text();k=(e.caseSensitive)?k:k.toLowerCase();for(var h=0,f=b.length;h<f;++h){if(!b[h].length){continue}j+=e.score(k,b[h])}j+=e.scoreTags(g.find("."+e.tagClass).text(),b);if(j>e.minSearchScore){d.push([j,g])}});return d},scoreTags:function(f,e){var h=this,j=0,c="",b=null;if(!f.length){return j}if(!e||!e.splice||!e.length){return j}f=((h.caseSensitive)?f:f.toLowerCase()).replace(/\s?(,|;)\s?/g," ");for(var g=0,d=e.length;g<d;++g){if(!e[g].length){continue}b=f.match(new RegExp("[^\\s]*("+e[g]+")[^\\s]*"));if(b){if(b[0].length==b[1].length){j+=h.exactTagScore}else{j+=h.partialTagScore}}}return j}})})(jQuery);