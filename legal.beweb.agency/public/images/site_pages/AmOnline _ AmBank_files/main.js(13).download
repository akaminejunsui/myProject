/* module-amb-interceptor@v1.0.0 build with â™¥ by bb-lp-cli@v1.9.17 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("base"),require("core"),require("angular-sanitize"),require("moment"),require("lodash")):"function"==typeof define&&define.amd?define(["base","core","angular-sanitize","moment","lodash"],t):"object"==typeof exports?exports["module-amb-interceptor"]=t(require("base"),require("core"),require("angular-sanitize"),require("moment"),require("lodash")):e["module-amb-interceptor"]=t(e.base,e.core,e["angular-sanitize"],e.moment,e.lodash)}(this,function(e,t,n,o,r){return function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={exports:{},id:o,loaded:!1};return e[o].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="/",t(0)}([function(e,exports,t){e.exports=t(1)},function(e,exports,t){var n;(function(e){"use strict";n=function(require,exports,e){e.name="module-amb-interceptor";var n=t(3),o=t(4),r=(t(5),[o.name,"ngSanitize"]);e.exports=n.createModule(e.name,r).config(t(6)).factory(t(7))}.call(exports,t,exports,e),!(void 0!==n&&(e.exports=n))}).call(exports,t(2)(e))},function(e,exports){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(t,exports){t.exports=e},function(e,exports){e.exports=t},function(e,exports){e.exports=n},function(e,exports,t){var n;n=function(require,exports,e){"use strict";e.exports=function(e){e.interceptors.push("ambHttpInterceptor")},e.exports.$inject=["$httpProvider"]}.call(exports,t,exports,e),!(void 0!==n&&(e.exports=n))},function(e,exports,t){var n;n=function(require,exports){var e,n,o=(t(8),t(9)),r={all:0,GET:0,POST:0,PATCH:0,PUT:0},i=[],a=!1,s=!1;window.cxp&&(e=cxp.mobile.plugins&&cxp.mobile.plugins.UserActivity,n=cxp.mobile.plugins&&cxp.mobile.plugins.SimpleStorage),exports.ambHttpInterceptor=function(t,c,u,l,f,p){function d(){setTimeout(function(){console.log(i.length),i.length>0&&(i[0](),i.shift(),u.publish("ambank-stopSpinner"))},1)}function g(){var e=setInterval(function(){var n=t.localStorage.getItem("isRefreshTokenReq");0!=n&&"false"!=n||(d(),clearInterval(e))},1e3)}function h(e){var t=e.replace(/[\u00A0-\u9999<>\&]/gim,function(e){return"&#"+e.charCodeAt(0)+";"});return t}function m(e){return $("<textarea />").html(e).text()}function v(e){return/[^\u0000-\u007F]/.test(e)}function b(e){var t=!1,n=o.unescape(e),r=o.unescape(n),i=o.unescape(r);v(i)&&(i=h(i),t=!0);var a;try{a=f(i)}catch(e){a="Invalid content format."}t&&(a=m(a));var s=o.unescape(a);return s}function x(e){for(var t in e)if(e.hasOwnProperty(t))if(e[t]instanceof Array)angular.forEach(e[t],function(e,t){e instanceof Array||e instanceof Object?x(e):null!=e&&"string"==typeof e&&(e=b(e))});else if(e[t]instanceof Object)for(var n in e[t])e[t].hasOwnProperty(n)&&(e[t][n]instanceof Array||e[t][n]instanceof Object?x(e[t][n]):null!=e[t][n]&&"string"==typeof e[t][n]?e[t][n]=b(e[t][n]):e[t][n]=e[t][n]);else null!=e[t]&&"string"==typeof e[t]?e[t]=b(e[t]):e[t];return e}var w,y=document.URL.indexOf("http://")===-1&&document.URL.indexOf("https://")===-1,k="/services/rest/v1/authorizations/refreshToken";w=c.isMobileDevice()&&y?t.localStorage.getItem("accessToken"):t.sessionStorage.getItem("accessToken");var S=function(e){O();var n=e;switch(e.url.indexOf("/phoenix-portal/services/rest/v1/")>-1&&(n.data=x(e.data),e=n),w&&(r.all++,r[e.method]++,t.localStorage.setItem("pendingHttpRequests",r),e.headers.authorization=w),p.use()){case"ta-MY":e.headers["Accept-Language"]="ta";break;case"bm-MY":e.headers["Accept-Language"]="ms";break;case"zh-MY":e.headers["Accept-Language"]="zh";break;case"en-MY":default:e.headers["Accept-Language"]="en"}var o=!1;if(e.url.indexOf(k)>=0)console.log(e.url),a=!0;else{navigator.userAgent.toLowerCase();o=t.localStorage.getItem("isRefreshTokenReq"),c.isMobileDevice()&&y&&null!=o&&void 0!=o&&(a="true"==o||"false"!=o&&o)}if(a){var s=l.defer();return i.push(function(){O(),e.headers.authorization=w,s.resolve(e)}),1===i.length&&e.url.indexOf(k)>=0&&(i[0](),i.shift()),c.isMobileDevice()&&y&&g(),s.promise}return e},I=function(o){if(O(),w){r.all--,r[o.config.method]--,t.localStorage.setItem("pendingHttpRequests",r);var c=o.headers("BackbaseServiceDestinationURL");if(null!=c){t.localStorage.setItem("lastActivity",Date.now()),e&&e.setLastActivity(Date.now())}o.config.url.indexOf(k)>=0&&(s=!0,a=!1)}n&&(null!=o.headers("cookie")?n.setItem(function(e){},function(e){},"webviewCookie",o.headers("cookie")):console.log("no cookie!")),s&&(i&&i.length>0?d():i&&i.length>0?d():s=!1);var u=o;return o.config.url.indexOf("/phoenix-portal/services/rest/v1/")>-1?(u.data=x(o.data),u):o},q=(document.body.constructor===window.HTMLBodyElement,function(n){if(w){r.all--,r[n.config.method]--,t.localStorage.setItem("pendingHttpRequests",r);var o=n.headers("BackbaseServiceDestinationURL");if(null!=o){t.localStorage.setItem("lastActivity",Date.now()),e&&e.setLastActivity(Date.now())}}if(n&&401==n.status||n.config.url.indexOf(k)>=0){if(n.headers()["www-authenticate"]&&n.headers()["www-authenticate"].includes("invalid_token")||n.headers()["www-authenticate"].includes("unauthorized")||n.config.url.indexOf(k)>=0){var i="Your session is no longer valid.",a=JSON.stringify(i);c.isMobileDevice()&&y?u.publish("amb.concurrentError",{}):(t.localStorage.setItem("ambConcurrentError",a),u.publish("amb.logout"))}}else d();throw n}),A=function(){return r},O=function(){w=c.isMobileDevice()&&y?t.localStorage.getItem("accessToken"):t.sessionStorage.getItem("accessToken")};return{getPending:A,request:S,response:I,responseError:q}},exports.ambHttpInterceptor.$inject=["$window","lpCoreUtils","lpCoreBus","$q","$sanitize","$translate"]}.call(exports,t,exports,e),!(void 0!==n&&(e.exports=n))},function(e,exports){e.exports=o},function(e,exports){e.exports=r}])});
//# sourceMappingURL=main.js.map